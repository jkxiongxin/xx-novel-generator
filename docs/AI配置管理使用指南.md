# AI配置管理使用指南

## 概述

AI配置管理功能允许用户自定义和管理多种AI模型配置，支持主流AI服务商以及自定义API端点。本指南将详细介绍如何使用这个功能。

## 功能入口

访问AI配置管理页面：
- URL: `/ai-configs`
- 菜单位置: 主导航 > AI配置

## 主要功能

### 1. 查看配置概览

进入AI配置管理页面后，您将看到：

**统计卡片**：
- 总配置数：显示您创建的所有配置数量
- 已启用：当前启用状态的配置数量
- 已禁用：当前禁用状态的配置数量
- 默认配置：是否设置了默认配置

**配置列表**：
- 支持列表视图和卡片视图切换
- 显示配置名称、模型类型、状态、优先级等信息
- 支持按名称、类型、状态筛选

### 2. 创建新配置

#### 方式一：手动创建

1. 点击"新建配置"按钮
2. 填写基础信息：
   - **配置名称**：为配置起一个容易识别的名称
   - **模型类型**：选择AI服务商类型
   - **描述**：可选，描述配置用途
   - **优先级**：1-10，数字越大优先级越高

3. 配置API信息：
   - **API端点**：AI服务的API地址
   - **请求格式**：选择对应的请求格式
   - **模型名称**：具体的模型名称
   - **API密钥**：您的API密钥

4. 设置请求参数：
   - **最大Token数**：单次请求的最大Token限制
   - **温度参数**：控制生成内容的随机性（0.0-1.0）
   - **超时时间**：请求超时时间（秒）
   - **重试次数**：失败时的重试次数

5. 高级配置（可选）：
   - **自定义请求头**：添加额外的HTTP请求头
   - **提示词配置**：设置系统消息和提示词模板
   - **使用限制**：设置每日/每月调用限制

#### 方式二：从模板创建

1. 点击"从模板创建"按钮
2. 选择预设模板：
   - **OpenAI GPT-3.5/4**：OpenAI官方API
   - **Claude 3**：Anthropic Claude API
   - **OpenRouter**：多模型代理服务
   - 更多模板持续添加中...

3. 输入API密钥
4. 可选：自定义配置名称
5. 预览配置信息并确认创建

### 3. 管理现有配置

#### 编辑配置
1. 在配置列表中点击"编辑"按钮
2. 修改所需参数
3. 保存更改

#### 测试配置
1. 点击"测试"按钮
2. 输入测试提示词
3. 可选：调整测试参数（Token数、温度）
4. 查看测试结果：
   - 成功：显示生成内容和响应时间
   - 失败：显示错误信息和故障排除建议

#### 状态管理
- **启用/禁用**：通过开关控制配置是否可用
- **设置默认**：指定默认使用的配置
- **调整优先级**：通过编辑功能修改优先级

#### 批量操作
1. 选择多个配置（勾选复选框）
2. 点击批量操作按钮：
   - 批量启用
   - 批量禁用
   - 批量删除

### 4. 配置详情查看

点击"查看"按钮可以查看配置的完整信息：
- 基础信息和状态
- API配置详情
- 请求参数设置
- 高级配置（如果有）
- 使用统计（未来版本）

## 常用配置示例

### OpenAI GPT-3.5 配置

```
配置名称: OpenAI GPT-3.5 Turbo
模型类型: OpenAI兼容
API端点: https://api.openai.com/v1/chat/completions
模型名称: gpt-3.5-turbo
请求格式: OpenAI Chat
API密钥: sk-your-api-key-here
最大Token数: 2000
温度参数: 0.7
```

### Claude 3 配置

```
配置名称: Claude 3 Sonnet
模型类型: Claude兼容
API端点: https://api.anthropic.com/v1/messages
模型名称: claude-3-sonnet-20240229
请求格式: Claude Messages
API密钥: your-anthropic-api-key
最大Token数: 2000
温度参数: 0.7
系统消息: 你是一个专业的小说创作助手...
```

### 自定义API配置

```
配置名称: 自定义模型服务
模型类型: 自定义HTTP
API端点: https://your-api.example.com/v1/generate
模型名称: custom-model-v1
请求格式: 自定义JSON
自定义请求头:
  Authorization: Bearer your-token
  Content-Type: application/json
请求参数映射:
  prompt: input_text
  max_tokens: max_length
响应映射:
  content: data.generated_text
```

## 配置使用

### 自动使用
配置创建并启用后，系统会自动在AI生成功能中使用：

1. **优先级顺序**：
   - 用户默认配置
   - 用户其他启用配置（按优先级）
   - 系统默认配置

2. **故障转移**：
   - 如果首选配置失败，会自动尝试其他可用配置
   - 确保生成功能的稳定性

### 手动指定
在支持的生成功能中，可以手动选择使用特定的配置。

## 安全建议

### API密钥安全
1. **定期更换**：建议定期更换API密钥
2. **权限最小化**：为API密钥设置最小必要权限
3. **监控使用量**：定期检查API调用量，防止异常使用

### 使用限制
1. **设置每日限制**：避免意外的大量调用
2. **监控成本**：关注API使用成本
3. **测试新配置**：新配置务必先测试后使用

## 故障排除

### 常见问题

**连接失败**：
- 检查API端点URL是否正确
- 验证网络连接
- 确认API服务状态

**认证错误**：
- 检查API密钥是否正确
- 确认密钥是否有效且未过期
- 验证密钥权限设置

**请求格式错误**：
- 确认选择的请求格式与API兼容
- 检查自定义请求头和参数映射
- 参考API文档验证格式

**响应解析错误**：
- 检查响应映射配置
- 确认API返回格式与预期一致
- 查看详细错误日志

### 获取帮助

如果遇到问题：
1. 查看测试结果中的错误信息
2. 参考故障排除建议
3. 检查API服务商文档
4. 联系技术支持

## 高级用法

### 提示词模板
使用提示词模板可以标准化AI交互：

```
系统消息模板：
你是一个专业的{genre}小说创作助手。你需要根据用户的要求，结合已有的世界观设定和角色信息，创作符合{style}风格的内容。

提示词模板：
基于以下信息创作内容：
- 小说类型：{genre}
- 世界观：{worldview}
- 角色信息：{characters}
- 用户要求：{user_input}

请创作{content_type}：
{prompt}
```

### 参数映射
对于非标准API，使用参数映射转换请求格式：

```
请求参数映射：
{
  "prompt": "input_text",
  "max_tokens": "max_length",
  "temperature": "randomness"
}

响应映射：
{
  "content": "data.response.text",
  "usage.total_tokens": "data.usage.total"
}
```

### 批量配置管理
对于多个环境或用途，可以创建多套配置：

1. **开发环境**：使用较小的模型，节省成本
2. **生产环境**：使用高质量模型，确保输出质量
3. **特定用途**：为不同类型的生成任务配置专门的模型

## 最佳实践

1. **命名规范**：使用清晰的命名方式，如"OpenAI-GPT4-Production"
2. **分类管理**：通过描述字段标注配置用途和特点
3. **定期测试**：定期测试配置确保正常工作
4. **备份配置**：为重要配置创建备份
5. **监控使用**：关注API调用量和成本
6. **版本管理**：记录配置变更，便于回滚

---

本指南涵盖了AI配置管理的主要功能和使用方法。如有疑问，请参考系统帮助或联系技术支持。