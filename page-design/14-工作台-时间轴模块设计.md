# 工作台-时间轴模块设计文档

## 模块概述

时间轴模块是AI小说创作平台工作台的重要辅助工具，负责管理和可视化小说中的时间线和重要事件。该模块提供直观的时间轴展示、事件管理和时间逻辑检查功能，帮助作者维护故事的时间一致性和情节连贯性。

## 设计目标

### 1. 时间管理
- 提供清晰的时间线可视化
- 支持多种时间尺度的展示
- 管理事件的时间关系和逻辑

### 2. 事件追踪
- 记录和管理小说中的重要事件
- 关联事件与角色、地点、章节
- 支持事件分类和标签管理

### 3. 一致性检查
- 自动检测时间逻辑错误
- 提供事件冲突警告
- 辅助维护故事连贯性

## 界面布局设计

### 1. 顶部筛选控制区
- **时间范围选择器**: 支持自定义时间范围查看
- **事件类型筛选**: 多选筛选不同类型的事件
- **角色筛选**: 选择特定角色相关的事件
- **章节筛选**: 按章节范围筛选事件
- **搜索框**: 支持事件名称和描述的全文搜索

### 2. 时间轴主体区域

#### 横向时间轴视图
- **时间刻度轴**: 根据故事时间跨度自动调整刻度
- **事件节点**: 在时间轴上显示事件标记点
- **事件线**: 连接相关事件的关系线
- **事件卡片**: 悬停显示事件详细信息
- **缩放控制**: 支持时间轴的放大缩小

#### 垂直列表视图
- **时间排序列表**: 按时间顺序排列的事件列表
- **事件分组**: 按日期、章节或事件类型分组
- **嵌套显示**: 支持子事件的层级展示

### 3. 右侧事件详情面板
- **事件基本信息**: 名称、类型、时间、章节
- **事件描述**: 详细的事件内容描述
- **关联信息**: 相关角色、地点、其他事件
- **时间设定**: 具体时间和持续时间
- **标签管理**: 事件标签的添加和编辑
- **操作按钮**: 编辑、删除、复制事件

### 4. 底部操作工具栏
- **添加事件**: 快速创建新事件
- **批量操作**: 批量编辑、删除、导出
- **时间检查**: 运行时间一致性检查
- **导出时间轴**: 导出为图片或文档
- **视图切换**: 在不同视图模式间切换

## 核心功能设计

### 1. 事件管理功能

#### 事件创建
- **快速创建**: 通过时间轴直接点击创建
- **详细创建**: 完整表单创建事件
- **批量导入**: 从表格文件批量导入事件
- **从章节提取**: 自动从章节内容提取事件

#### 事件分类系统
- **事件类型**:
  - 重大历史事件
  - 角色关键事件
  - 剧情转折点
  - 世界观事件
  - 自定义类型

- **事件属性**:
  - 重要程度（1-5级）
  - 影响范围（个人/地区/全局）
  - 事件状态（计划/进行/完成）
  - 保密等级（公开/内部/机密）

### 2. 时间线可视化功能

#### 多尺度时间轴
- **年份视图**: 显示跨年的重大事件
- **月份视图**: 显示月度事件安排
- **日期视图**: 显示具体日期的事件
- **章节视图**: 按章节顺序显示事件

#### 交互式展示
- **缩放功能**: 平滑的时间轴缩放
- **拖拽导航**: 拖拽浏览不同时间段
- **事件聚焦**: 点击事件自动居中显示
- **关系高亮**: 显示事件间的关联关系

#### 视觉设计
- **色彩编码**: 不同类型事件使用不同颜色
- **图标标识**: 每种事件类型的独特图标
- **重要程度**: 通过大小区分事件重要性
- **状态指示**: 不同状态使用不同样式

### 3. 事件关联功能

#### 角色关联
- **参与角色**: 记录事件的参与者
- **主导角色**: 标识事件的主要推动者
- **影响角色**: 记录受事件影响的角色
- **角色状态**: 事件对角色状态的改变

#### 地点关联
- **发生地点**: 事件的具体发生位置
- **影响区域**: 事件影响的地理范围
- **地点变化**: 事件对地点的影响

#### 章节关联
- **所属章节**: 事件在哪个章节中发生
- **跨章节事件**: 跨越多个章节的长期事件
- **章节影响**: 事件对后续章节的影响

### 4. 时间一致性检查

#### 自动检查功能
- **时间冲突检测**: 发现时间逻辑矛盾
- **角色时间线检查**: 验证角色行为的时间合理性
- **事件依赖检查**: 确保前置事件已发生
- **持续时间验证**: 检查事件持续时间的合理性

#### 问题报告
- **冲突列表**: 详细的时间冲突报告
- **严重程度**: 区分严重和轻微的问题
- **修复建议**: 提供具体的修复方案
- **批量修复**: 支持批量应用修复建议

### 5. 导出和分享功能

#### 多格式导出
- **图片导出**: 将时间轴导出为PNG/JPG
- **PDF导出**: 生成可打印的时间轴文档
- **表格导出**: 导出为Excel/CSV格式
- **文本导出**: 生成结构化的文本描述

#### 分享功能
- **链接分享**: 生成可分享的时间轴链接
- **嵌入代码**: 提供网页嵌入代码
- **协作分享**: 与其他用户共享编辑权限

## 用户体验设计

### 1. 交互体验

#### 直观操作
- **拖拽创建**: 在时间轴上拖拽创建事件
- **拖拽调整**: 直接拖拽调整事件时间
- **右键菜单**: 丰富的右键快捷操作
- **键盘快捷键**: 常用操作的快捷键支持

#### 智能提示
- **时间建议**: 根据已有事件智能建议时间
- **关联提示**: 提示可能相关的角色和事件
- **冲突警告**: 实时显示潜在的时间冲突
- **完整性提示**: 提醒缺失的关键信息

### 2. 响应式设计

#### 多设备适配
- **桌面端**: 完整功能的大屏展示
- **平板端**: 优化的触控操作界面
- **移动端**: 简化的核心功能展示

#### 性能优化
- **虚拟滚动**: 大量事件的高效渲染
- **懒加载**: 按需加载事件详情
- **缓存策略**: 智能的数据缓存机制

### 3. 可访问性设计

#### 无障碍支持
- **键盘导航**: 完整的键盘操作支持
- **屏幕阅读器**: 对屏幕阅读器的友好支持
- **高对比度**: 支持高对比度显示模式
- **字体缩放**: 支持界面字体大小调整

## 数据结构设计

### 1. 时间轴事件数据模型
```
TimelineEvent {
  id: 事件唯一标识
  novel_id: 所属小说ID
  name: 事件名称
  description: 事件描述
  event_type: 事件类型
  start_time: 开始时间
  end_time: 结束时间
  chapter_number: 关联章节号
  importance_level: 重要程度(1-5)
  impact_scope: 影响范围
  status: 事件状态
  privacy_level: 保密等级
  related_characters: 关联角色ID列表
  related_locations: 关联地点
  related_events: 关联事件ID列表
  tags: 标签列表
  notes: 备注信息
  created_at: 创建时间
  updated_at: 更新时间
}
```

### 2. 时间关系数据模型
```
TimelineRelation {
  id: 关系唯一标识
  source_event_id: 源事件ID
  target_event_id: 目标事件ID
  relation_type: 关系类型(因果/并行/包含)
  strength: 关系强度
  description: 关系描述
}
```

## 技术架构设计

### 1. 前端技术选型
- **时间轴渲染**: D3.js或Vis.js进行时间轴可视化
- **日期处理**: Day.js进行日期时间处理
- **图表库**: ECharts进行统计图表展示
- **虚拟滚动**: vue-virtual-scroller优化性能

### 2. 后端API设计
- **RESTful接口**: 标准的CRUD操作
- **实时同步**: WebSocket支持实时更新
- **批量操作**: 支持批量数据处理
- **数据导出**: 多格式数据导出接口

### 3. 数据存储设计
- **关系数据库**: 存储结构化的事件数据
- **索引优化**: 时间和关联查询的索引优化
- **数据备份**: 定期的数据备份机制

## 扩展功能设计

### 1. 高级分析功能
- **时间密度分析**: 分析事件在时间上的分布
- **角色活跃度**: 统计角色在不同时期的活跃程度
- **情节节奏分析**: 分析故事节奏的快慢变化
- **事件影响力**: 评估事件的长期影响

### 2. AI辅助功能
- **智能时间推理**: AI自动推断事件的合理时间
- **事件关联发现**: 自动发现潜在的事件关联
- **时间冲突修复**: AI辅助解决时间逻辑冲突
- **情节建议**: 基于时间轴给出情节发展建议

### 3. 协作功能
- **多人编辑**: 支持团队协作编辑时间轴
- **版本控制**: 时间轴的版本管理和回退
- **评论讨论**: 事件的评论和讨论功能
- **权限管理**: 细粒度的编辑权限控制

## 集成设计

### 1. 与其他模块的集成
- **章节模块**: 从章节中自动提取时间事件
- **角色模块**: 同步角色的重要事件
- **世界观模块**: 关联世界观的历史事件
- **大纲模块**: 与大纲的重大事件保持同步

### 2. 外部工具集成
- **日历应用**: 与外部日历工具的同步
- **项目管理**: 与项目管理工具的集成
- **文档工具**: 与文档编辑工具的协作

## 质量保证设计

### 1. 数据验证
- **时间格式验证**: 确保时间数据的正确格式
- **逻辑一致性**: 验证事件时间的逻辑合理性
- **必填字段**: 关键信息的完整性检查
- **数据范围**: 时间范围的合理性验证

### 2. 错误处理
- **优雅降级**: 数据加载失败时的优雅处理
- **错误恢复**: 自动恢复机制
- **用户提示**: 清晰的错误信息提示
- **日志记录**: 详细的操作日志记录

### 3. 性能监控
- **加载性能**: 监控时间轴的加载速度
- **渲染性能**: 监控大量事件的渲染性能
- **内存使用**: 监控内存使用情况
- **用户体验**: 收集用户体验反馈

## 总结

时间轴模块作为AI小说创作平台的重要辅助工具，设计重点在于：

1. **直观的可视化**: 提供清晰、美观的时间轴展示
2. **强大的管理功能**: 完善的事件管理和关联功能
3. **智能的辅助工具**: AI驱动的时间推理和冲突检测
4. **良好的集成性**: 与其他模块的深度集成
5. **优秀的用户体验**: 流畅的交互和响应式设计

该模块将帮助作者更好地管理小说的时间线，维护故事的逻辑一致性，提升创作质量和效率。通过可视化的时间轴展示，作者可以直观地看到故事的时间发展脉络，及时发现和解决时间逻辑问题。