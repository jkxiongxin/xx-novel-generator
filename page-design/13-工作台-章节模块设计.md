# 工作台-章节模块设计文档

## 模块概述

章节模块是AI小说创作平台工作台的核心创作工具，负责小说章节内容的创建、编辑和管理。该模块集成了富文本编辑器、AI生成功能、章节管理和创作辅助工具，为作者提供完整的写作环境。

## 技术架构

### 前端组件架构
```
views/workspace/Chapters.vue (主容器)
├── components/chapters/ChapterList.vue (章节列表)
├── components/chapters/ChapterEditor.vue (章节编辑器)
├── components/chapters/RichTextEditor.vue (富文本编辑器)
├── components/chapters/ChapterAIGenerator.vue (AI生成组件)
├── components/chapters/AIReviewDialog.vue (AI审核对话框)
├── components/chapters/ChapterSummaryDialog.vue (章节总结对话框)
├── components/chapters/TimelineMarkerDialog.vue (时间轴标记对话框)
├── components/chapters/ChapterPreview.vue (章节预览)
└── components/chapters/PromptSelector.vue (提示词选择器)
```

### 后端API架构
- **基础路由**: `/api/v1/chapters`
- **数据模型**: `Chapter`
- **枚举类型**: `ChapterStatus`
- **Schema定义**: 完整的数据验证和响应格式

## 界面布局设计

### 1. 顶部控制区域设计
- **章节选择器**: 下拉选择章节，支持快速跳转
- **快捷操作按钮**: 新建章节、预览章节
- **视图切换控制**: 列表视图、编辑器视图、大纲视图

### 2. 主体内容区域设计

#### 列表视图
- **筛选和搜索区**: 章节标题搜索、状态筛选、章节范围筛选
- **章节卡片网格**: 每个章节显示为独立卡片
  - 章节基本信息：章节号、标题、状态标签
  - 章节统计：字数、更新时间、参与角色数
  - 章节预览：内容前几行预览
  - 操作按钮：编辑、预览、更多操作下拉菜单

#### 编辑器视图
- **章节基本信息区域**
  - 章节标题输入框
  - 章节状态选择器（草稿/已完成/已发布）
  - 实时统计：字数、段落数、预计阅读时间
  - 自动保存状态提示

- **AI生成提示词选择区域**
  - 可折叠的提示词配置面板
  - 包含内容选择：世界观、大纲、角色、上下文等
  - 用户建议输入框
  - 生成参数设置：模式、字数、创意程度

- **富文本编辑器**
  - 基于Quill.js的富文本编辑器
  - 自定义工具栏：格式化、插入角色、插入对话模板
  - 实时字数统计和光标位置显示
  - 自动保存功能

- **侧边栏助手**
  - 章节信息标签页：统计信息、版本历史、关联角色
  - 写作助手标签页：快速插入模板、角色信息参考、写作进度
  - 大纲参考标签页：当前章节大纲、情节点、参与角色

- **底部操作栏**
  - 保存按钮
  - AI生成按钮
  - AI审核按钮
  - 生成总结按钮
  - 时间轴标记按钮

## 核心功能设计

### 1. 章节管理功能
- **创建章节**: 支持空白创建和基于大纲创建
- **编辑章节**: 富文本编辑，支持格式化和多媒体插入
- **章节状态管理**: 草稿、已完成、已发布状态切换
- **版本控制**: 章节历史版本管理和回退
- **批量操作**: 支持批量删除、导出、状态修改

### 2. AI辅助创作功能

#### 提示词构建系统
- **内容选择器**: 可选择包含的小说相关信息
  - 世界观：世界地图、修炼体系、历史、阵营势力
  - 大纲：故事线、角色成长路线、重大事件、当前/前后章节大纲
  - 角色：当前活跃角色列表、角色详细信息
  - 上下文：前一章节末尾内容

- **生成参数配置**
  - 生成模式：续写模式、重写模式、全新创作
  - 目标字数：100-10000字可调节
  - 创意程度：保守-平衡-创新三档
  - 用户建议：自定义创作要求输入

#### AI生成对话框
- **生成进度显示**: 步骤化进度条和状态提示
- **生成结果展示**: 多标签页展示内容、说明、建议
- **结果操作**: 重新生成、优化内容、采用内容、逐段选择

### 3. AI审核功能
- **自动审核**: 语法检查、逻辑一致性、内容连贯性
- **问题分类**: 语法问题、逻辑问题、内容问题
- **修改建议**: 每个问题提供具体修改建议
- **批量处理**: 一键应用所有建议或逐个处理

### 4. 章节总结功能
- **总结生成**: 基于章节内容生成摘要
- **总结类型**: 简要/详细/完整三种长度
- **侧重点选择**: 情节/角色/世界观/其他
- **总结应用**: 保存到章节备注或用于下一章生成

### 5. 时间轴标记功能
- **事件标记**: 为章节中的重要事件添加时间轴标记
- **事件分类**: 重大事件、角色事件、剧情转折、其他
- **关联角色**: 选择事件相关的角色
- **时间设定**: 事件发生的时间描述

## 用户体验设计

### 1. 响应式布局设计
- **桌面端**: 三栏布局，左侧章节列表，中间编辑器，右侧助手
- **平板端**: 二栏布局，可折叠侧边栏
- **移动端**: 单栏布局，底部标签导航

### 2. 交互体验优化
- **快捷键支持**: 常用操作的键盘快捷键
- **拖拽排序**: 章节列表支持拖拽重新排序
- **实时同步**: 多设备间的实时同步
- **离线编辑**: 支持离线编辑，联网后自动同步

### 3. 视觉设计规范
- **色彩系统**: 主色调配合状态色彩区分
- **图标设计**: 统一的图标风格和规范
- **字体排版**: 编辑器专用字体，提升阅读体验
- **动效设计**: 适当的过渡动画和加载效果

## 数据管理设计

### 1. 数据结构设计
- **章节基础信息**: ID、小说ID、章节号、标题、状态
- **章节内容**: 富文本内容、字数统计、版本信息
- **关联数据**: 参与角色、关联大纲、时间轴事件
- **元数据**: 创建时间、更新时间、用户ID

### 2. 状态管理设计
- **本地状态**: 当前编辑章节、视图模式、编辑状态
- **持久化状态**: 章节列表、选中章节、用户偏好
- **缓存策略**: 章节内容缓存、AI生成结果缓存

### 3. 数据同步机制
- **自动保存**: 定时自动保存编辑内容
- **版本管理**: 保存关键版本，支持版本回退
- **冲突处理**: 多设备编辑冲突的检测和解决

## 性能优化设计

### 1. 渲染优化
- **虚拟滚动**: 大量章节时使用虚拟滚动
- **懒加载**: 章节内容按需加载
- **图片优化**: 编辑器中图片的压缩和延迟加载

### 2. 网络优化
- **请求合并**: 批量API请求优化
- **缓存策略**: HTTP缓存和本地存储缓存
- **增量同步**: 只同步变更的内容

### 3. 内存优化
- **组件复用**: 章节编辑器组件的复用
- **数据清理**: 及时清理不需要的数据
- **大文件处理**: 超长章节的分片处理

## 安全性设计

### 1. 数据保护
- **自动备份**: 定期自动备份章节内容
- **版本保护**: 防止意外删除重要版本
- **权限控制**: 章节编辑权限验证

### 2. 内容安全
- **敏感词过滤**: AI生成内容的敏感词检查
- **内容审查**: 发布前的内容合规检查
- **数据加密**: 重要内容的加密存储

## 扩展性设计

### 1. 插件化架构
- **编辑器插件**: 支持自定义编辑器功能
- **AI插件**: 支持接入不同的AI服务
- **导入导出插件**: 支持多种格式的导入导出

### 2. API设计
- **RESTful API**: 标准的REST API设计
- **GraphQL支持**: 复杂查询的GraphQL接口
- **Webhook**: 支持外部系统集成

### 3. 国际化设计
- **多语言支持**: 界面和提示的多语言
- **本地化适配**: 不同地区的使用习惯适配
- **字体支持**: 多语言字体的支持

## 测试策略设计

### 1. 功能测试
- **单元测试**: 核心功能的单元测试覆盖
- **集成测试**: API接口的集成测试
- **端到端测试**: 完整用户流程的自动化测试

### 2. 性能测试
- **加载性能**: 页面加载和渲染性能测试
- **并发测试**: 多用户同时编辑的并发测试
- **压力测试**: 大量数据下的系统稳定性测试

### 3. 用户体验测试
- **可用性测试**: 用户操作流程的可用性评估
- **兼容性测试**: 不同浏览器和设备的兼容性
- **无障碍测试**: 残障用户的无障碍访问测试

## 总结

章节模块是整个AI小说创作平台的核心创作工具，设计重点在于：

1. **专业的写作环境**: 提供富文本编辑器和完整的创作工具
2. **智能AI辅助**: 深度集成AI生成、审核、总结功能
3. **高效的管理工具**: 完善的章节管理和组织功能
4. **优秀的用户体验**: 响应式设计和流畅的交互
5. **强大的扩展能力**: 支持插件化和第三方集成

该设计确保了章节模块能够满足不同层次作者的创作需求，从新手的AI辅助创作到专业作者的高效管理，都能提供良好的支持。