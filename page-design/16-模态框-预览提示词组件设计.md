# 模态框-预览提示词组件设计文档

## 组件概述

预览提示词模态框是AI小说创作平台的核心AI交互组件，负责在AI生成执行前展示和优化提示词内容。该组件集成了智能提示词构建、效果预测、参数调整和质量评估功能，为用户提供可视化的AI生成控制体验。

## 技术架构

### 组件层次结构
```
components/modals/PromptPreviewModal.vue (主组件)
├── components/ai/PromptBuilder.vue (提示词构建器)
├── components/ai/ContextSelector.vue (上下文选择器)
├── components/ai/ParameterPanel.vue (参数配置面板)
├── components/ai/QualityPredictor.vue (质量预测器)
├── components/ai/HistoryLearner.vue (历史学习组件)
└── components/common/LoadingSpinner.vue (加载状态)
```

### API集成点
- **提示词服务**: `/api/v1/prompts/templates`
- **生成预测**: `/api/v1/generation/predict`
- **质量评估**: `/api/v1/ai/quality-score`
- **历史分析**: `/api/v1/ai/user-patterns`

## 界面布局设计

### 1. 模态框整体结构

#### 尺寸规格
- **桌面端**: 900px宽 × 700px高
- **平板端**: 90%视窗宽度 × 85%视窗高度
- **移动端**: 全屏模式，底部弹出式设计

#### 布局分区
```
┌─────────────────────────────────────────────────────┐
│ 头部区域 - 标题与快捷操作                              │
├─────────────────────────────────────────────────────┤
│ 左侧面板 (40%)        │ 右侧面板 (60%)                │
│ ┌─────────────────────┐ │ ┌─────────────────────────┐  │
│ │ 上下文选择器        │ │ │ 提示词预览区域          │  │
│ │ - 世界观信息        │ │ │ - 最终提示词内容        │  │
│ │ - 角色信息          │ │ │ - 语法高亮显示          │  │
│ │ - 大纲信息          │ │ │ - 字符统计              │  │
│ │ - 历史内容          │ │ └─────────────────────────┘  │
│ └─────────────────────┘ │ ┌─────────────────────────┐  │
│ ┌─────────────────────┐ │ │ AI参数配置              │  │
│ │ 智能推荐建议        │ │ │ - 生成模式选择          │  │
│ │ - 优化建议          │ │ │ - 创意程度调节          │  │
│ │ - 历史学习          │ │ │ - 长度控制              │  │
│ │ - 效果预测          │ │ │ - 温度参数              │  │
│ └─────────────────────┘ │ └─────────────────────────┘  │
├─────────────────────────────────────────────────────┤
│ 底部操作区域 - 生成/取消/保存模板                        │
└─────────────────────────────────────────────────────┘
```

### 2. 核心功能区域设计

#### 上下文选择器 (ContextSelector)
- **信息类别标签**
  - 世界观标签：显示可选世界观要素数量和状态
  - 角色标签：显示相关角色数量和重要性评分
  - 大纲标签：显示当前章节和前后章节大纲
  - 历史标签：显示上文内容和风格分析

- **智能推荐系统**
  - 基于生成类型自动推荐相关上下文
  - 显示推荐理由和重要性评分
  - 支持一键选择推荐配置

- **上下文预览**
  - 每个选中项目的简要预览
  - 字符数统计和影响评估
  - 冲突检测和兼容性提示

#### 提示词预览区域 (PromptBuilder)
- **动态构建展示**
  - 实时显示最终组装的提示词
  - 不同部分用颜色区分（系统提示/用户内容/上下文）
  - 语法高亮和格式化显示

- **质量评分系统**
  - AI驱动的提示词质量评分（0-100分）
  - 分类评分：清晰度、完整性、相关性、创新性
  - 改进建议和优化提示

- **效果预测**
  - 基于历史数据预测生成效果
  - 显示可能的输出类型和质量预期
  - 风险提示和注意事项

## 核心AI功能设计

### 1. 智能提示词构建系统

#### 动态组装引擎
```typescript
interface PromptBuilderConfig {
  // 基础配置
  generationType: 'character' | 'outline' | 'chapter' | 'worldview';
  contextIncludes: {
    worldview?: boolean;
    characters?: boolean;
    outline?: boolean;
    history?: boolean;
    userSuggestion?: boolean;
  };
  
  // AI参数
  aiParams: {
    temperature: number;      // 0.1-2.0
    maxTokens: number;       // 100-8000
    creativityLevel: 'conservative' | 'balanced' | 'creative';
    focusAreas?: string[];   // 重点关注领域
  };
  
  // 质量控制
  qualityRequirements: {
    minQualityScore: number;
    contentFilters: string[];
    styleGuidelines: string[];
  };
}
```

#### 上下文智能选择
- **相关性算法**: 基于内容相似度自动选择相关上下文
- **重要性评分**: 为每个上下文元素评估重要性（0-1分）
- **冗余检测**: 自动检测和去除重复或冗余信息
- **长度优化**: 在保持质量的前提下优化提示词长度

### 2. AI质量预测系统

#### 多维度评估
- **语义完整性**: 检查提示词的语义完整性和逻辑性
- **上下文相关性**: 评估上下文信息的相关程度
- **生成可行性**: 预测AI模型能否准确理解和执行
- **创新潜力**: 评估提示词的创新和创意空间

#### 历史学习机制
```typescript
interface UserPromptPattern {
  userId: string;
  preferredContextTypes: string[];
  successfulParams: AIParameters[];
  failurePatterns: string[];
  qualityTrends: QualityTrend[];
  stylePreferences: StylePreference[];
}
```

### 3. 实时优化建议系统

#### 智能优化建议
- **结构优化**: 建议更好的提示词结构和顺序
- **参数调整**: 基于内容特点建议最优参数设置
- **上下文补充**: 推荐可能遗漏的重要上下文信息
- **风险提醒**: 识别可能导致低质量输出的风险因素

#### 一键优化功能
- **自动优化**: 基于AI建议自动调整提示词和参数
- **风格匹配**: 根据用户历史风格自动调整
- **目标适配**: 根据生成目标自动优化配置
- **质量保证**: 确保优化后的配置满足最低质量要求

## 交互体验设计

### 1. 响应式交互流程

#### 初始化加载
1. **快速预加载**: 基于生成类型预加载相关模板
2. **智能推荐**: 自动推荐最佳上下文配置
3. **历史恢复**: 恢复用户上次的配置偏好
4. **质量检查**: 初始配置的质量评估

#### 实时交互反馈
- **参数调整**: 实时显示参数变化对质量评分的影响
- **上下文变更**: 动态更新提示词预览和质量评估
- **建议响应**: 智能建议的实时更新和推送
- **预测更新**: 效果预测的实时计算和显示

### 2. 高级交互功能

#### 拖拽式上下文管理
- **拖拽排序**: 支持拖拽调整上下文信息的优先级
- **可视化权重**: 通过拖拽调整不同上下文的权重比例
- **智能建议**: 拖拽过程中的实时优化建议
- **冲突检测**: 拖拽操作可能导致的冲突提示

#### 模板化管理
- **保存模板**: 将当前配置保存为可复用模板
- **模板分类**: 按生成类型和场景分类管理模板
- **快速应用**: 一键应用历史成功模板
- **智能合并**: 多个模板的智能合并功能

### 3. 快捷操作设计

#### 键盘快捷键
- `Ctrl+Enter`: 执行生成
- `Ctrl+S`: 保存当前配置为模板
- `Ctrl+R`: 重置到推荐配置
- `Ctrl+O`: 一键优化当前配置
- `Tab`: 在不同配置区域间切换

#### 智能按钮
- **一键最优**: 基于AI分析的最优配置
- **风格匹配**: 匹配用户历史创作风格
- **快速预览**: 生成简短预览而非完整内容
- **质量保证**: 确保配置满足质量要求后才允许生成

## 数据管理设计

### 1. 状态管理架构

#### Pinia Store结构
```typescript
interface PromptPreviewStore {
  // 当前状态
  currentConfig: PromptBuilderConfig;
  contextData: ContextData;
  qualityScore: QualityScore;
  predictions: GenerationPrediction[];
  
  // 历史数据
  userPatterns: UserPromptPattern;
  templateLibrary: PromptTemplate[];
  successHistory: PromptSuccess[];
  
  // 操作方法
  updateConfig: (config: Partial<PromptBuilderConfig>) => void;
  predictQuality: () => Promise<QualityScore>;
  optimizePrompt: () => Promise<PromptBuilderConfig>;
  saveTemplate: (name: string) => Promise<void>;
}
```

#### 本地缓存策略
- **配置缓存**: 用户配置偏好的本地存储
- **模板缓存**: 常用模板的离线缓存
- **质量缓存**: 质量评估结果的临时缓存
- **历史缓存**: 成功配置的历史记录缓存

### 2. 数据同步机制

#### 实时同步
- **配置同步**: 配置变更的实时云端同步
- **质量计算**: 异步质量评估和结果更新
- **建议推送**: 智能建议的实时推送
- **状态持久化**: 关键状态的自动持久化

#### 离线支持
- **离线模式**: 基本功能的离线可用性
- **智能缓存**: 关键数据的智能预缓存
- **同步恢复**: 网络恢复后的数据同步
- **冲突解决**: 离线期间数据冲突的智能解决

## 性能优化设计

### 1. 渲染性能优化

#### 虚拟化技术
- **长列表虚拟化**: 大量上下文选项的虚拟滚动
- **懒加载组件**: 非关键组件的按需加载
- **计算缓存**: 复杂计算结果的智能缓存
- **防抖处理**: 高频操作的防抖优化

#### 组件优化
- **异步组件**: 非核心功能的异步加载
- **内存管理**: 及时清理不需要的数据和引用
- **事件优化**: 事件监听器的高效管理
- **更新优化**: 最小化不必要的组件重渲染

### 2. 网络性能优化

#### API调用优化
- **请求合并**: 相关API请求的智能合并
- **缓存策略**: 多层级缓存提升响应速度
- **预加载**: 可能需要数据的预加载
- **错误重试**: 智能重试机制和降级策略

#### 数据传输优化
- **数据压缩**: 大数据量的压缩传输
- **增量更新**: 只传输变更部分
- **批量操作**: 多个操作的批量处理
- **流式传输**: 大数据的流式处理

## 安全性设计

### 1. 数据安全

#### 敏感信息保护
- **API密钥保护**: AI服务API密钥的安全管理
- **用户数据加密**: 敏感用户数据的客户端加密
- **传输安全**: HTTPS和数据传输加密
- **存储安全**: 本地存储数据的加密保护

#### 访问控制
- **权限验证**: 用户操作权限的严格验证
- **会话管理**: 安全的会话状态管理
- **操作审计**: 关键操作的审计日志
- **异常监控**: 异常操作的实时监控和报警

### 2. 内容安全

#### AI生成安全
- **内容过滤**: AI生成内容的安全过滤
- **敏感词检测**: 多语言敏感词检测和处理
- **合规检查**: 内容合规性的自动检查
- **风险评估**: 生成内容的风险等级评估

#### 用户输入安全
- **输入验证**: 严格的用户输入验证和清理
- **XSS防护**: 跨站脚本攻击的防护
- **注入防护**: SQL注入和代码注入的防护
- **恶意内容检测**: 恶意内容的智能检测

## 扩展性设计

### 1. AI模型扩展

#### 多模型支持
- **模型适配器**: 不同AI模型的统一适配接口
- **性能比较**: 多个模型的效果比较和选择
- **模型切换**: 运行时的AI模型动态切换
- **个性化模型**: 基于用户数据的个性化模型

#### 功能扩展
- **插件系统**: 第三方功能插件的集成支持
- **自定义模板**: 用户自定义提示词模板系统
- **API扩展**: 开放API供第三方集成
- **微服务演进**: 向微服务架构的演进支持

### 2. 国际化设计

#### 多语言支持
- **界面国际化**: 所有界面元素的多语言支持
- **提示词本地化**: 不同语言的提示词模板
- **文化适配**: 不同文化背景的创作风格适配
- **时区处理**: 全球用户的时区自动处理

#### 本地化适配
- **输入法支持**: 不同输入法的优化支持
- **字体适配**: 多语言字体的自动适配
- **排版优化**: 不同语言的排版规则适配
- **文化敏感性**: 文化敏感内容的智能处理

## 测试策略设计

### 1. 功能测试

#### 单元测试
- **组件测试**: 各个子组件的独立功能测试
- **工具函数测试**: 核心算法和工具函数的测试
- **状态管理测试**: Pinia store的状态管理测试
- **API集成测试**: API调用的模拟和集成测试

#### 集成测试
- **端到端测试**: 完整用户流程的自动化测试
- **AI功能测试**: AI生成功能的效果验证测试
- **性能测试**: 不同负载下的性能表现测试
- **兼容性测试**: 不同浏览器和设备的兼容性测试

### 2. AI效果测试

#### 质量评估测试
- **生成质量测试**: AI生成内容质量的量化评估
- **一致性测试**: 相同配置多次生成的一致性测试
- **创新性测试**: 生成内容创新性和多样性测试
- **用户满意度测试**: 用户对生成效果的满意度调研

#### 性能基准测试
- **响应时间测试**: 不同配置下的响应时间基准
- **准确性测试**: 提示词理解和执行的准确性测试
- **稳定性测试**: 长时间运行的稳定性测试
- **错误处理测试**: 异常情况下的错误处理能力测试

## 总结

预览提示词模态框组件是AI小说创作平台的核心交互入口，其设计重点在于：

1. **智能化体验**: 通过AI驱动的提示词构建和优化，提供智能化的用户体验
2. **深度定制**: 支持高度定制的提示词配置和参数调整
3. **质量保证**: 多维度的质量评估和预测系统确保生成效果
4. **学习进化**: 从用户行为中学习，不断优化推荐和建议
5. **扩展性强**: 良好的架构设计支持功能扩展和AI模型升级

该组件将成为用户与AI生成功能交互的核心界面，通过提供专业、智能、直观的提示词预览和配置体验，显著提升用户的创作效率和生成内容质量。